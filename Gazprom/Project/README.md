# Прогнозирование отказов оборудования и аварийных ситуаций на газопроводах, нефтедобывающих и специализированных установках

---

## Информация о проекте

**Выполнил:** Мурадян Денис Степанович  
**Разработано для конкурса проектов от ПАО "Газпром" в рамках студенческой олимпиады 2024-2025**

---

## Краткое описание проекта

Данный проект представляет собой систему для выявления риска отказа оборудования на определённом участке газопровода в режиме реального времени. Система анализирует поступающие данные с датчиков и оценивает вероятность отказа оборудования в течение ближайшего часа. Искусственная симуляция и генерация датасетов используются для демонстрации работоспособности решения.

### Важность

- **Безопасность:** Система позволяет существенно повысить безопасность работы персонала, своевременно выявляя потенциальные угрозы и предотвращая аварийные ситуации.
- **Экономическая эффективность:** Предотвращение аварий снижает финансовые потери, связанные с ремонтными работами, простоями оборудования и экологическими штрафами.
- **Экологическая устойчивость:** Оптимизация работы объектов снижает риск экологических катастроф, минимизируя утечки и выбросы, что способствует сохранению окружающей среды.


### Актуальность

В условиях постоянно растущих требований к надежности инфраструктуры и безопасности эксплуатации, данное решение позволяет оперативно 
реагировать на изменения в состоянии оборудования. Система обеспечивает непрерывный мониторинг и предсказание отказов,
что является критически важным для газопроводов, нефтедобывающих предприятий и других объектов энергетического комплекса.

### Целевая аудитория

- **Операторы и инженеры:** Система предоставляет оперативную информацию, позволяющую быстро принимать решения о профилактическом обслуживании и устранении неисправностей.
- **Руководители и менеджеры по эксплуатации:** Инструмент для оптимизации расходов и повышения надежности работы объектов, позволяющий минимизировать затраты на аварийный ремонт и простои.
- **Исследователи и специалисты по инновациям:** Платформа для демонстрации и внедрения передовых алгоритмов глубокого обучения и анализа потоковых данных, способствующая развитию интеллектуальных систем управления инфраструктурой.

---

## Структура проекта

```plaintext
Project/
├── app/
│   ├── main.py               # Серверное приложение на базе FastAPI, реализующее REST API для предсказаний и дашборда
│   ├── inference.py          # Функции для предобработки данных и вызова модели для предсказаний
│   └── dashboard.html        # HTML-страница для визуального отображения показателей риска отказа оборудования
├── data/
│   ├── generate_dataset.py   # Скрипт для искусственной генерации датасета с имитацией поступления данных с датчиков
│   ├── sensor_train_data.csv # Сгенерированные данные для обучения модели
│   ├── sensor_val_data.csv   # Сгенерированные данные для валидации модели
│   └── sensor_test_data.csv  # Сгенерированные данные для тестирования модели
├── model/
│   ├── model.py              # Скрипт для подготовки данных, построения и обучения GRU-модели, а также логирования параметров обучения
│   ├── logs/
│   │   ├──total_log.txt      # Информация о модели и отслеживаемых параметрах
│   │   └──training_log.txt   # Информация о модели на каждой эпохе
│   └── saved_models/
│       └── gru_model.h5      # Сохранённая обученная модель
├── simulation data/      
│   └── data_simulator.py     # Скрипт для симуляции поступления данных в режиме реального времени
└── README.md                 # Документация проекта
```

---

## Принцип работы системы

Система работает по следующей схеме:

- **Получение данных:** Поступление данных с датчиков в режиме реального времени. Для демонстрации работы используется искусственная генерация данных с помощью скрипта `generate_dataset.py` для подготовки обучающих примеров и `data_simulator.py` для имитации потока данных.
  
- **Обработка данных:** Данные проходят нормализацию и преобразование в нужный формат в модуле `inference.py`, после чего поступают на вход обученной модели.

- **Предсказание отказа:** Загруженная GRU-модель анализирует последовательности из 20 отсчетов (с 5 параметрами) и оценивает вероятность отказа оборудования в течение следующего часа.

- **Доступ к результатам:** Сервер, реализованный в `app/main.py`, предоставляет REST API для получения предсказаний и отображения дашборда, где можно контролировать текущие показатели риска для каждой установки.

### Основные модули и их роль

- **app/main.py**  
  Запускает сервер FastAPI, загружает сохранённую модель и реализует следующие API-эндпоинты:
  - **/predict:** Принимает последовательность данных с датчиков и возвращает рассчитанную вероятность отказа.
  - **/update и /predictions:** Обновляют и хранят последние предсказания для каждой установки.
  - **/dashboard:** Отдает HTML-страницу для визуального контроля показателей риска отказа.

- **app/inference.py**  
  Содержит функции для нормализации входных данных и выполнения предсказания модели.

- **data/generate_dataset.py**  
  Формирует синтетический датасет, имитируя поступление данных с датчиков. Для каждой из 10 установок задаются базовые параметры (давление, температура, вибрация, расход газа), которые затем изменяются под воздействием случайных колебаний и событий, имитирующих начало отказа.

- **model/model.py**  
  Отвечает за:
  - Формирование последовательностей данных и разметку сценариев отказа.
  - Построение GRU-модели для бинарной классификации (отказ/без отказа).
  - Обучение модели с логированием основной информации об обучении в файлы `total_log.txt` и `training_log.txt`, расположенные в каталоге `model/logs`.
  
- **data_simulator.py**  
  Иммитирует поток данных, формируемых на основе датасета, и отправляет их на сервер для демонстрации работы системы в условиях, приближенных к реальным.

---

## Датасет

### Структура и формирование данных

Датасет формируется с помощью `generate_dataset.py` и используется для обучения модели,
ее валидации и демонстрации работоспособности системы. Каждая запись датасета содержит следующие признаки:

- **timestamp:** Временная метка (например, `2025-03-15 11:00:01`).
- **segment_id:** Идентификатор установки (A1, A2, …, A10).
- **pressure:** Давление, исходные значения около 7.0–9.0 bar с постепенным изменением.
- **temperature:** Температура, исходные значения около 20.0–25.0 °C.
- **vibration:** Уровень вибрации, исходные значения около 0.03–0.07 м/с.
- **flow_rate:** Расход газа, исходные значения около 150.0–250.0 м³/час.

### Принцип формирования данных

- **Нормальные условия работы:**
Для каждой установки задаются базовые значения, которые затем подвергаются естественному дрейфу и случайным колебаниям для имитации реалистичной работы.
- **Симуляция отказа:**
Для отдельных установок в случайный момент запускается предписание, имитирующее начало отказа.
Это может выражаться в резком изменении давления, уменьшении пропускаемости, последовательном повышении температуры или 
вибрации - что демонстрирует неправильную работу установки и последующий выход из строя.
Предписание отказа для случайной установки выдается с вероятностью 0.5% - класс отказа "малозаметный", что требует максимально высокой чувствительности системы.
Из 10 000 нормальных показаний важно выявить даже единственный отказ, так как его обнаружение имеет критическое значение.
- **Предписания для установок:**
На основании изменений параметров системе присваивается метка риска отказа, что позволяет операторам своевременно принимать меры по профилактике.

---

## Создание и обучение модели

### Выбор архитектуры

В задачах анализа данных с датчиков, где измерения производятся каждую секунду,
крайне важно учитывать временные взаимосвязи между последовательными наблюдениями.
При работе с такими данными традиционные модели, например, MLP (Multi-Layer Perceptron),
не справляются с захватом динамики изменений, поскольку они обрабатывают данные последовательно, независимо от предыдущих показаний.

Рекуррентные нейронные сети (RNN – Recurrent Neural Network) специально созданы для анализа
последовательных данных. Они обрабатывают следующие данные на основе уже обработанных,
что делает их более подходящими для решения подобных задач.
Однако классические RNN страдают от проблемы затухания и взрыва градиента,
особенно при обработке длинных последовательностей, что затрудняет обучение модели.

В связи с этим была выбрана архитектура GRU (Gated Recurrent Unit) — усовершенствованная версия RNN,
которая благодаря элементам управления потоком данных частично решает проблему затухания и взрыва градиента.
Это позволяет GRU эффективно улавливать временные зависимости в данных с датчиков, обеспечивая более
точную классификацию редких, но критически важных событий.

### Сценарии отказа

В процессе подготовки данных в модуле `model/model.py` реализованы следующие сценарии, указывающие на риск отказа:
- Резкое увеличение давления на протяжении последовательности (рост более 20%).
- Последовательное повышение температуры в условиях устойчиво высокого давления.
- Сохранение высокого уровня давления при снижении расхода газа.
- Сочетание постоянного высокого уровня вибрации с непрерывным ростом температуры.
- Дополнительные эвристические условия, учитывающие экстремальные значения отдельных параметров.

### Логирование

Основная информация об обучении модели фиксируется в файлах, расположенных в каталоге `model/logs`:
- `total_log.txt` информация о модели и ее параметрах
- `training_log.сsv` информация о параметрах в каждой эпохе

В этих файлах сохраняются данные о модели, отслеживаемых параметрах, использовании памяти и времени тренировки.

### Настройка гиперпараметров

Используемые гиперпараметры:
- **Loss function:** Focal Loss для бинарной классификации
- **Количество слоев:** 2
- **Количество нейронов:** [64, 32]
- **Метрики:** Accuracy, AUC, Precision, Recall
- **Количество эпох:** 50

### Результаты обучения

```
Type: GRU-based RNN (Sequential model)
Count layers: 2
Count neurons: [64, 32]
Loss function: binary_crossentropy
Count epochs: 30
Metrics: accuracy, <AUC name=auc>
Memory used during training: 481.40 MB
Total training time: 52.35 seconds

Baseline metrics:
Loss before training (Train): 0.7590
Loss before training (Validation): 0.7918

Final metrics:
Loss after training (Train): 0.1890
Loss after training (Validation): 0.3273
Training metrics: loss = 0.1890, accuracy = 0.9119, auc = 0.9763
Validation metrics: loss = 0.3273, accuracy = 0.8759, auc = 0.9454
```

Анализ полученных значений показывает, что модель хорошо обучилась и демонстрирует высокую точность предсказаний, что позволяет эффективно оценивать риск отказа оборудования.

---

## Получение и обработка данных

### REST API

Серверное приложение в `app/main.py` предоставляет REST API для:
- Приёма данных с датчиков через POST-запросы на эндпоинт `/predict`.
- Обновления и хранения последних предсказаний через эндпоинты `/update` и `/predictions`.
- Отдачи HTML-дашборда на эндпоинте `/dashboard` для визуального контроля показателей риска.

### Симуляция данных

Скрипт `data_simulator.py` формирует данные из датасета, имитируя поток информации, поступающий от датчиков в реальном времени. Полученные данные отправляются на сервер для обработки и получения предсказаний.

---

## Запуск проекта

1. **Запуск сервера**  
   Выполните в терминале:
   ```bash
   python app/main.py
   ```
   Сервер будет доступен по адресу `http://127.0.0.1:8000`.

2. **Открытие дашборда**  
   После запуска сервера откройте браузер и перейдите по адресу:
   [http://127.0.0.1:8000/dashboard](http://127.0.0.1:8000/dashboard)  
   Здесь отображаются текущие предсказания вероятности отказа для каждой установки.

3. **Запуск симуляции данных**  
   В отдельном терминале выполните:
   ```bash
   python data_simulator.py
   ```
   Скрипт начнет имитировать поток данных и отправлять их на сервер.

---

## Заключение

Данный проект демонстрирует интегрированное решение для мониторинга и прогнозирования отказов оборудования на основе анализа данных, поступающих в реальном времени. Применение GRU-модели для анализа временных рядов, искусственное формирование датасета для демонстрации работоспособности и развертывание системы через REST API позволяют создать прототип, способный повышать безопасность эксплуатации объектов. Система позволяет своевременно выявлять риски отказов, проводить профилактическое обслуживание и предотвращать аварийные ситуации.

---
```